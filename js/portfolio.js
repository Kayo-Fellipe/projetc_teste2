// Portfolio Data - Define all projects and their galleries
const portfolioData = {
  sessao_leonardo_monique: {
    title: "Sessão Leonardo & Monique",
    type: "photography",
    items: [
      {
        type: "image",
        src: "https://i.postimg.cc/CKZPMfGG/DSC-0088-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/CKZPMfGG/DSC-0088-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/VsXhbM34/DSC-0081-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/VsXhbM34/DSC-0081-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/K88pVW4s/DSC-0058-VSCO-Original.jpg",
        thumbnail: "https://i.postimg.cc/K88pVW4s/DSC-0058-VSCO-Original.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/fTKg8sW9/DSC-0059-VSCO-Original.jpg",
        thumbnail: "https://i.postimg.cc/fTKg8sW9/DSC-0059-VSCO-Original.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/wBSW1T2S/DSC-0092-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/wBSW1T2S/DSC-0092-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/fLm8mngk/DSC-0097-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/fLm8mngk/DSC-0097-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/D0hBcjt6/DSC-0043-VSCO-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/D0hBcjt6/DSC-0043-VSCO-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/L4kysS1b/DSC-0104-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/L4kysS1b/DSC-0104-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/9QggjB7X/DSC-0017-VSCO-Original.jpg",
        thumbnail: "https://i.postimg.cc/9QggjB7X/DSC-0017-VSCO-Original.jpg"
      }
    ]
  },
  
  sessao_evandro_pamella: {
    title: "Sessão Evandro & Pamella",
    type: "photography",
    items: [
      {
        type: "image",
        src: "https://i.postimg.cc/mkGBy4Ln/DSC0019-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/mkGBy4Ln/DSC0019-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/4dpTd06Q/DSC0007-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/4dpTd06Q/DSC0007-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/sXW3WxrS/DSC0006-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/sXW3WxrS/DSC0006-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/Xq36ygxS/DSC0027-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/Xq36ygxS/DSC0027-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/kg59cfC7/Full-Size-Render-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/kg59cfC7/Full-Size-Render-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/BvkqtDd4/DSC0040-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/BvkqtDd4/DSC0040-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/rsCchHzw/DSC0046-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/rsCchHzw/DSC0046-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/ryS8FDg2/DSC0050-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/ryS8FDg2/DSC0050-VSCO.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/3J1YmzPL/DSC0060-VSCO.jpg",
        thumbnail: "https://i.postimg.cc/3J1YmzPL/DSC0060-VSCO.jpg"
      }
    ]
  },
  sessao_ana_rodrigues: {
    title: "Sessão Ana Rodrigues",
    type: "photography",
    items: [
      {
        type: "image",
        src: "https://i.postimg.cc/L8hcgtnJ/IMG-5564.jpg",
        thumbnail: "https://i.postimg.cc/L8hcgtnJ/IMG-5564.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/BQhWvYQW/DSC00467.jpg",
        thumbnail: "https://i.postimg.cc/BQhWvYQW/DSC00467.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/HndGrFym/IMG-5562.jpg",
        thumbnail: "https://i.postimg.cc/HndGrFym/IMG-5562.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/MKZ2q2wb/IMG-5563.jpg",
        thumbnail: "https://i.postimg.cc/MKZ2q2wb/IMG-5563.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/MKgDtV9M/DSC00645.jpg",
        thumbnail: "https://i.postimg.cc/MKgDtV9M/DSC00645.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/Z53LQnQf/IMG-5561.jpg",
        thumbnail: "https://i.postimg.cc/Z53LQnQf/IMG-5561.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/Jn7ctqzg/DSC00651.jpg",
        thumbnail: "https://i.postimg.cc/Jn7ctqzg/DSC00651.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/QM3qZsGj/DSC00690.jpg",
        thumbnail: "https://i.postimg.cc/QM3qZsGj/DSC00690.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/XJwS7nXx/DSC00653.jpg",
        thumbnail: "https://i.postimg.cc/XJwS7nXx/DSC00653.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/1zrr9Tsw/DSC00596.jpg",
        thumbnail: "https://i.postimg.cc/1zrr9Tsw/DSC00596.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/63HVZv7Q/DSC00714.jpg",
        thumbnail: "https://i.postimg.cc/63HVZv7Q/DSC00714.jpg"
      },
      {
        type: "image",
        src: "https://i.postimg.cc/xCrV2Xjc/DSC00482.jpg",
        thumbnail: "https://i.postimg.cc/xCrV2Xjc/DSC00482.jpg"
      }
    ]
  },
  
  renascer: {
    title: "Filmagem Ana Rodrigues",
    type: "videography",
    items: [
      {
        type: "youtube",
        src: "nQm9rewdjBs",
        thumbnail: "https://i.postimg.cc/cCmpwTRn/DSC00876.jpg"
      },
    ]
  },
};



// Utility Functions
function convertYouTubeUrl(videoId) {
  return `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
}

function isYouTubeUrl(url) {
  return url.includes('youtube.com/watch?v=') || url.includes('youtu.be/');
}

function extractYouTubeId(url) {
  const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
  const match = url.match(regExp);
  return (match && match[2].length === 11) ? match[2] : null;
}

// Portfolio Class
class Portfolio {
  constructor() {
    this.currentProject = null;
    this.currentIndex = 0;
    this.init();
  }

  init() {
    this.bindEvents();
    this.setupFiltering();
  }

  bindEvents() {
    // Portfolio links
    const portfolioLinks = document.querySelectorAll('.portfolio-link');
    portfolioLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const projectId = link.getAttribute('data-project');
        this.openGallery(projectId);
      });
    });

    // Modal controls
    const modal = document.getElementById('gallery-modal');
    const closeBtn = document.getElementById('close-modal');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');

    closeBtn.addEventListener('click', () => this.closeGallery());
    prevBtn.addEventListener('click', () => this.previousItem());
    nextBtn.addEventListener('click', () => this.nextItem());

    // Close modal when clicking outside
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        this.closeGallery();
      }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (modal.classList.contains('active')) {
        switch(e.key) {
          case 'Escape':
            this.closeGallery();
            break;
          case 'ArrowLeft':
            this.previousItem();
            break;
          case 'ArrowRight':
            this.nextItem();
            break;
        }
      }
    });
  }

  setupFiltering() {
    const filterBtns = document.querySelectorAll('.filter-btn');
    const portfolioItems = document.querySelectorAll('.portfolio-item');

    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        // Update active button
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // Filter items
        const filter = btn.getAttribute('data-filter');
        
        portfolioItems.forEach(item => {
          if (filter === 'all' || item.classList.contains(filter)) {
            item.style.display = 'block';
            setTimeout(() => {
              item.style.opacity = '1';
              item.style.transform = 'translateY(0)';
            }, 10);
          } else {
            item.style.opacity = '0';
            item.style.transform = 'translateY(20px)';
            setTimeout(() => {
              item.style.display = 'none';
            }, 300);
          }
        });
      });
    });
  }

  openGallery(projectId) {
    const project = portfolioData[projectId];
    if (!project) return;

    this.currentProject = project;
    this.currentIndex = 0;

    // Update modal content
    document.getElementById('gallery-title').textContent = project.title;
    document.getElementById('total-items').textContent = project.items.length;

    // Generate thumbnails
    this.generateThumbnails();

    // Show first item
    this.showCurrentItem();

    // Show modal
    const modal = document.getElementById('gallery-modal');
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';

    // Update navigation buttons
    this.updateNavigation();
  }

  closeGallery() {
    const modal = document.getElementById('gallery-modal');
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';

    // Clear iframe sources to stop videos
    const iframes = modal.querySelectorAll('iframe');
    iframes.forEach(iframe => {
      iframe.src = '';
    });

    this.currentProject = null;
    this.currentIndex = 0;
  }

  showCurrentItem() {
    if (!this.currentProject) return;

    const item = this.currentProject.items[this.currentIndex];
    const galleryMain = document.getElementById('gallery-main');
    
    // Update counter
    document.getElementById('current-index').textContent = this.currentIndex + 1;

    // Clear current content
    galleryMain.innerHTML = '';

    // Add new content based on type
    if (item.type === 'image') {
      const img = document.createElement('img');
      img.src = item.src;
      img.alt = this.currentProject.title;
      img.addEventListener('load', () => {
        img.style.opacity = '1';
      });
      img.style.opacity = '0';
      img.style.transition = 'opacity 0.3s ease';
      galleryMain.appendChild(img);
    } 
    else if (item.type === 'video') {
      const iframe = document.createElement('iframe');
      iframe.src = item.src;
      iframe.allow = 'autoplay; fullscreen; picture-in-picture';
      iframe.allowFullscreen = true;
      galleryMain.appendChild(iframe);
    }
    else if (item.type === 'youtube') {
      const iframe = document.createElement('iframe');
      iframe.src = convertYouTubeUrl(item.src);
      iframe.allow = 'autoplay; fullscreen; picture-in-picture';
      iframe.allowFullscreen = true;
      galleryMain.appendChild(iframe);
    }
    else if (item.type === 'external-link') {
      const linkContainer = document.createElement('div');
      linkContainer.className = 'external-link-container';
      linkContainer.innerHTML = `
        <div class="external-link-content">
          <i class="fas fa-external-link-alt"></i>
          <h3>${item.title || 'Ver Conteúdo Externo'}</h3>
          <p>Este conteúdo está hospedado externamente</p>
          <a href="${item.src}" target="_blank" class="btn btn-primary">
            <i class="fas fa-arrow-right"></i> Abrir Link
          </a>
        </div>
      `;
      galleryMain.appendChild(linkContainer);
    }

    // Update thumbnail active state
    this.updateThumbnailActive();
    this.updateNavigation();
  }

  generateThumbnails() {
    const thumbnailsContainer = document.getElementById('gallery-thumbnails');
    thumbnailsContainer.innerHTML = '';

    this.currentProject.items.forEach((item, index) => {
      const thumbnail = document.createElement('div');
      thumbnail.className = `thumbnail ${item.type}`;
      if (index === 0) thumbnail.classList.add('active');

      const img = document.createElement('img');
      img.src = item.thumbnail;
      img.alt = `${this.currentProject.title} ${index + 1}`;
      
      thumbnail.appendChild(img);
      thumbnail.addEventListener('click', () => {
        this.currentIndex = index;
        this.showCurrentItem();
      });

      thumbnailsContainer.appendChild(thumbnail);
    });
  }

  updateThumbnailActive() {
    const thumbnails = document.querySelectorAll('.thumbnail');
    thumbnails.forEach((thumb, index) => {
      thumb.classList.toggle('active', index === this.currentIndex);
    });
  }

  previousItem() {
    if (!this.currentProject || this.currentIndex <= 0) return;
    this.currentIndex--;
    this.showCurrentItem();
  }

  nextItem() {
    if (!this.currentProject || this.currentIndex >= this.currentProject.items.length - 1) return;
    this.currentIndex++;
    this.showCurrentItem();
  }

  updateNavigation() {
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');

    if (!this.currentProject) return;

    prevBtn.disabled = this.currentIndex <= 0;
    nextBtn.disabled = this.currentIndex >= this.currentProject.items.length - 1;
  }
}

// Initialize Portfolio when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
  new Portfolio();
});